name: CD

on:
  workflow_run:
    workflows: ["CI"]
    types:
      - completed

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          distribution: "temurin"
          java-version: "17"

      - name: Save Google Play service account JSON file
        run: |
          echo "${{ secrets.GOOGLE_PLAY_SERVICE_ACCOUNT_JSON }}" > /tmp/google-play-service-account.json

      - name: Install dependencies
        run: |
          yarn install

      - name: Run Fastlane to upload Android build to Google Play
        run: |
          cd android
          fastlane beta

      - name: Clean up
        run: rm /tmp/google-play-service-account.json
